{% extends "base_generic.html" %}
 <title>{% block title %} log_in {% endblock %}</title>
{% block content %}

<div id="login_type">
		<div class="capt" style="border:2px solid white;"><strong style="background-color:white;border:2px solid blue;color:black;border-radius:5px;">SELECT LOGIN TYPE</strong>
			<pre style="line-height: 2px;border:2px solid red;" id="preview">
			<input style="margin-left:-20%;" type="radio" name="login" value="Staff Account" id="staff_login"> <strong style="border-radius:5px;background-color:orange;border:2px solid black;">STAFF</strong></input><input style="margin-left:23%;" type="radio" name="login" value="Student Account" id="student_login"> <strong style="border-radius:5px;background-color:gold;border:2px solid white;">STUDENT</strong> </input><input style="margin-left:20%;" type="radio" name="login" value="Sign_up" id="staff_signup"> <strong style="border-radius: 5px;background-color:brown;color:white;border:2px solid red;"> STAFF SIGNUP</strong> </input>
			</pre>
		</div>
</div>

<form method="post" action="{% url 'logins' %}" id="Staff_Account" class='form' hidden>
		<div class="capt"><strong>STAFF LOGIN</strong></div>
		{% csrf_token %}
		<label for="user">User Name</label>
		<input style="background-color:orange;opacity:0.3;color:black;border-radius:5px;width:15%;" required type="text" name="username" placeholder ="username" id="user_name" value =""></input>
		<label for="passward">Password</label>
		<input style="background-color:orange;opacity:0.3;color:white;border-radius:5px;width:15%;" required type="password" name="password" placeholder="Ll018311" id="user_password"></input> 
		<button type='submit' name="staffSubmit" style="margin-left:42%;background-color:blue;color:black;border-radius:5px;"> <span class="glyphicon glyphicon-log-in" style="margin-right:5px;"></span><strong>Login</strong></button><br>
		<span style="font-size:10px;color:#BF3C89;opacity:0.9;margin-left:0%;">*Staff loggings: Enter User name and password, then <u>double</u> click the submit button </span>
</form>
<form method="post" action="{% url 'user_qury' %}" id="Sign_up" class='form' hidden>
		<div class="capt"><strong>STAFF SIGNUP</strong></div>
		{% csrf_token %}
		<label for="user" style="font-size:48%;margin-left:6%;">Username:</label><label for="email" style="font-size:48%;margin-left:6%;">Email:</label><label for="passward" style="font-size:48%;margin-left:6%;">Password:</label><label for="passward1" style="font-size:48%;margin-left:0%;">Confirm Password:</label><br>
		<em style="margin-left:10%;">
			<input style="width:18%;background-color:orange;opacity:0.3;color:black;border-radius:5px;" maxlength='8' required type="text" name="username" placeholder ="username" id="signup" autofocus="autofocus"  value =""></input>
			<input style="width:20%;background-color:orange;opacity:0.3;color:black;border-radius:5px;" required type="email" name="email" placeholder ="examples@umqhs.com" id="email"></input>
			<input style="width:18%;background-color:orange;opacity:0.3;color:black;border-radius:5px;" required type="password" name="password" placeholder ="Ll01831@1" id="sign_passward"></input>
			<input style="width:18%;background-color:orange;opacity:0.3;color:black;border-radius:5px;" required type="password" name="password1" placeholder ="Ll01831@1" id="confirm"></input> 
		</em><br>
		<span style="font-size:10px;color:gray;opacity:0.9;margin-left:20%;color:orange;" id="minimum" hidden>*......sign-up here with minimum of eight chracters username</span>
		<span style="font-size:10px;color:gray;opacity:0.9;margin-left:20%;color:indigo;" id="unique" hidden>*......a valid and unique email is compulsory for new account!</span>
		<span style="font-size:10px;color:gray;opacity:0.9;margin-left:20%;color:red;" id="enter_valid_email" hidden>*......please enter a valid email address!</span>
		<span style="font-size:10px;color:gray;opacity:0.9;margin-left:20%;color:violet;" id="create_key" hidden>*......create your unique strong passward!</span>
		<span style="font-size:10px;color:gray;opacity:0.9;margin-left:20%;color:green;" id="confirmed_key" hidden>*......confirm your unique passward in the next box!</span>
		<span style="font-size:10px;color:gray;opacity:1;margin-left:20%;color:dodgerblue;" id="valid" hidden>*......a valid <i> ref number </i>from admin must be provided to complete the registration!</span>
		<span style="font-size:10px;color:gray;opacity:1;margin-left:20%;color:dodgerblue;" id="invalid" hidden>*......the <i> ref number </i>provided is invalid, contact the admin for valid ref No.</span><br>
		<span style="background-color:red;border-radius:5px;color:white;margin-left:15%;" id="error" hidden> <strong> <span class="glyphicon glyphicon-exclamation-sign"></span> Fix the error in your passward.</strong></span>
		<ul>
			<li style="margin-left:20%;font-size:10px;" id="length" hidden>Password length must be at least nine characters.</li>
			<li style="margin-left:20%;font-size:10px;" id="cases" hidden>passward should contain upper and lower case letter (A-z).</li>
			<li style="margin-left:20%;font-size:10px;" id="digit" hidden>Password should contain digit betwwen (0-9).</li>
			<li style="margin-left:20%;font-size:10px;" id="characters" hidden>Password should contain any of the special characters (!@#$%^&*()_-).</li>
		</ul>
		<span style="background-color:green;border-radius:5px;color:white;margin-left:37%;" id="Oky" hidden><span class="glyphicon glyphicon-ok-circle"></span> Password entered is Okay.</span>
		<span style="background-color:silver;border-radius:5px;color:white;margin-left:32%;" id="mismatched" hidden><span class="glyphicon glyphicon-asterisk"></span> The two passward entered are not matched.</span>
		<span style="background-color:orange;border-radius:5px;color:white;margin-left:37%;opacity:0.6;" id="weak_key" hidden><span class="glyphicon glyphicon-info-sign"></span> Your password is <i>too</i> weak.</span>
		<input style="width:10%;margin-left:42%;border:2px solid yellow;color:green;border-radius:5px;" required type="password" placeholder ="code" name="ref_id" id="ref_id" hidden></input>
		<button type='submit' id="signupSubmit" style="margin-left:42%;background-color:crimson;color:white;border-radius:5px;" hidden> <span class="glyphicon glyphicon-ok" style="margin-right:5px;"></span><strong>Submit</strong></button>
</form>
<form method="post" action="{% url 'student_login' %}" id="Student_Account" class='form' hidden>
		<div class="capt"><strong>STUDENT LOGIN</strong></div>
		{% csrf_token %}
		<label for="name">Student Name</label>
		<input style="background-color:orange;opacity:0.3;color:black;border-radius:5px;width:15%;" required type="studentname" name="studentname" placeholder ="Surname first" id="student_name" value =""></input>
		<label for="id">Student ID</label> 
		<input style="background-color:orange;opacity:0.3;color:black;border-radius:5px;width:15%;" required type="password" name="studentid" placeholder ="AA/J/24/1423" id="student_id" title="AA/J/24/1423"></input>
		<button type='submit' name="studentSubmit" style="margin-left:42%;background-color:blue;color:red;border-radius:5px;"> <span class="glyphicon glyphicon-log-in" style="margin-right:5px;"></span><strong>Login</strong></button><br>
		<span style="font-size:10px;color:#BF3C89;opacity:0.9;margin-left:0;">*Student loggings: Enter full name, Identification Number and <u>double</u> click the submit button </span>
</form>
<script>
	$("input:radio[name='login']").change(function() {
	var login_type = $(this);
	switch(login_type.val()){
        case "Staff Account":
			$("#Staff_Account").show();
			$("#Student_Account").hide();
			$("#Sign_up").hide();
			Staff_Account.style.backgroundColor = 'silver';
			break
        case "Student Account":
			$("#Student_Account").show();
			$("#Staff_Account").hide();
			$("#Sign_up").hide();
			Student_Account.style.backgroundColor = 'seashell';
			break
        case "Sign_up":
			$("#Student_Account").hide();
			$("#Staff_Account").hide();
			$("#Sign_up").show();
			$("#minimum").show();
			Sign_up.style.backgroundColor = 'white';
			}
    
	});
	$('.form').submit(function (evt) {
           evt.preventDefault();
	
	$("#signup").change(function(){
		var username = $(this).val();
		$.ajax({
			url: "{% url  'user_qury' %}",
			data: {'username':username
			},
			dataType: 'json',
			success: function(data) {
				if (data.is_taken == 'null'){
					$("#unique").show();
				}
				else {
					alert(data.error_message)
				}
				localStorage.setItem("current_data", JSON.stringify(data));
			}
		})
		
		
	});
	
	$("#email").change(function(){
		var current_data = JSON.parse(localStorage.getItem("current_data"))
		if (/(\S+)@(\S+)\.(\S+)/.exec($(this).val()) != null){
			if (Object.values(current_data).indexOf($(this).val()) == -1){
		$("#sign_passward").show();
		$("#unique").hide();
		$("#create_key").show();
		}
		else{
			alert('Use another email, a user with this email already exists.')
			
			$("#unique").show();
			$("#create_key").hide();
			$("#enter_valid_email").hide();
		}
		}
		else {$("#enter_valid_email").show();
			$("#unique").hide();
		}
	});
	$("#sign_passward").change(function(){
		var passward = $(this);
		var isOkay = true;
		if (passward.val().match(/\d+/) == null){
			$("#error").show();
			$("#digit").show();
			isOkay = false;
		}
		
		if (passward.val().match(/[A-Z]/) == null){
			$("#error").show();
			$("#cases").show();
			isOkay = false;
		}
		if (passward.val().match(/[a-z]/) == null){
			$("#error").show();
			$("#cases").show();
			isOkay = false;
		}
		if (passward.val().length < 8){
			$("#error").show();
			$("#length").show();
			isOkay = false;
		}
		if (isOkay == false){
			passward.removeClass("goodBox").addClass("errorBox");
		}
		else {
		passward.removeClass("errorBox").addClass("goodBox");
		$("#Oky").show();
		$("#confirm").show();
		$("#error").hide();
		$("#characters").hide();
		$("#cases").hide();
		$("#digit").hide();
		$("#unique").hide();
		$("#confirmed_key").show();
		$("#length").hide();
		$("#create_key").hide();
		localStorage.setItem("current_key", JSON.stringify($(this).val()));
		if (passward.val().match(/[!@#$%^&*()_-]/) != null){
			$("#strong_key").show();
			$("#weak_key").hide();
		}else {$("#weak_key").show();
				$("#error").show();
			   $("#characters").show();
			   $("#Oky").hide();}
		}
		return false;
	});
	$("#confirm").change(function(){
		localStorage.setItem("confirm_key", JSON.stringify($(this).val()));
		var kek = JSON.parse(localStorage.getItem("current_key"));
		var key = JSON.parse(localStorage.getItem("confirm_key"))
		if (kek == key){
			var passward = $(this);
			$("#ref_id").show();
			$("#confirmed_key").hide();
			$("#valid").show();
			$("#weak_key").hide();
			$("#error").hide();
			$("#characters").hide();
			$("#mismatched").hide();
			$("#Oky").hide();
			passward.removeClass("errorBox").addClass("goodBox");
		}else {$("#mismatched").show();
				$("#Oky").hide();
				var passward = $(this);
				passward.removeClass("goodBox").addClass("errorBox");}
		
	});
	$("#ref_id").change(function(){
		var ref_no = ['234', '345', '8970', '5467', '345', '8902']
		if (ref_no.indexOf($(this).val()) != -1) {
		$("#ref_id").hide();
		$("#Oky").hide();
		$("#valid").hide();
		$("#mismatched").hide();
		$("#signupSubmit").show();
		
		}
		else {$("#invalid").show();
		$("#Oky").hide();
		$("#valid").hide();
		$("#mismatched").hide();}
	});
      $("button[name='staffSubmit']").click(function() {
         var datas =  {'username': $("#user_name").val(), 'password': $("#user_password").val()};
           $.ajax({
			url: "{% url  'user_qury' %}",
			data:datas,
			dataType: 'json',
			success: function(data) {
				if (data.is_taken != 'null'){
                                        alert('Logging in as '+datas.username); 
					$.ajax({
			                      url: "{% url  'logins' %}",
			                      data: datas,		                      
                                             dataType: 'json',	    
                                             success: function(data) {
                                             location.replace('http://127.0.0.1:8838/result/'+data.redirect+'/')
                                            }           
		                          })
				}
				else {
					alert(data.error_message)
				}
			}
		})
          });
   $("button[name='studentSubmit']").click(function() {
		var pas = $("#student_id").val();
		if (/^[A-Z]*[/][A-Z][/][0-9]*[/][0-9]*$/.test(pas) == true){
                      $.ajax({
                          url:"{% url  'user_qury' %}",
                         data: {'student_id':pas},
                        dataType: 'json',
                       success: function(data) {
                              if (data.valid_id){
                                  alert('Name: '+data.name+'  ID: '+pas);
                                  localStorage.removeItem('tries');
                                  localStorage.setItem('passward', pas.split('/')[3]);
                                  localStorage.setItem('user_name', JSON.stringify(user_name));
                                 $.ajax({
			                      url: "{% url  'student_login' %}",
			                      data: {'student_id':pas},		                      
                                             dataType: 'json',	    
                                             success: function(data) {
                                             location.replace('http://127.0.0.1:8838/result/'+data.redirect+'/')
                                            }           
		                          })
                                  }
                                else {
                                    alert(data.error_message)
                                 }
                                 }
                                })
		         }else {alert(pas + ' is a wrong identification number!')}
	});
	});
	</script>
{% endblock %}
